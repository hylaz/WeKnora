# 知海租户管理平台需求文档

## 1. 项目概述

### 1.1 项目背景
知海租户管理平台是 WeKnora 知识库系统的后台管理平台，用于系统管理员对租户进行统一管理、监控和配置。通过该平台，管理员可以高效地管理多个租户账户，监控租户资源使用情况，并进行系统配置和数据分析。

### 1.2 项目目标
- 提供完整的租户生命周期管理功能
- 实时监控租户资源使用情况
- 支持租户配置管理和调整
- 提供数据统计和分析功能
- 确保系统安全性和操作可追溯性

### 1.3 目标用户
- **系统管理员**：负责租户的创建、管理、配置和监控
- **运营人员**：负责租户数据分析和报表生成

## 2. 功能需求

### 2.1 租户管理模块

#### 2.1.1 租户列表
**功能描述**：以列表形式展示所有租户信息，支持搜索、筛选和分页。

**功能点**：
- 展示租户基本信息：ID、名称、描述、业务标识、状态、创建时间
- 展示租户资源使用情况：存储配额、已使用存储
- 支持按租户名称、业务标识、状态进行搜索和筛选
- 支持分页显示，默认每页20条
- 支持按创建时间、更新时间排序
- 显示租户状态标识（活跃/禁用）
- 提供快速操作入口：查看详情、编辑、删除

**数据字段**：
- 租户ID
- 租户名称
- 描述
- 业务标识（business）
- API Key（部分显示，支持复制）
- 状态（active/inactive）
- 存储配额（storage_quota）
- 已使用存储（storage_used）
- 存储使用率
- 检索引擎配置（retriever_engines）
- 创建时间
- 更新时间

**交互要求**：
- 列表支持行选择（单选/多选）
- 支持批量操作（批量启用/禁用、批量删除）
- 点击行可进入详情页
- API Key 显示时仅显示前6位和后4位，中间用*号代替，提供"复制"按钮

#### 2.1.2 创建租户
**功能描述**：通过表单创建新的租户账户。

**功能点**：
- 租户名称（必填，唯一性校验）
- 租户描述（可选）
- 业务标识（必填，下拉选择或文本输入）
- 检索引擎配置（必填）
  - 支持选择检索引擎类型：keywords（关键词检索）、vector（向量检索）
  - 支持选择检索引擎类型：postgres
  - 至少选择一种检索引擎
- 存储配额（可选，默认10GB，单位：GB/MB）
- 表单验证：名称必填、名称唯一性、存储配额为正整数
- 提交后自动生成 API Key
- 创建成功后跳转到租户详情页

**表单字段**：
```
- 租户名称：文本输入框（必填）
- 描述：多行文本输入框（可选）
- 业务标识：文本输入框（必填）
- 检索引擎配置：
  - 添加引擎按钮
  - 引擎列表（可删除）
    - 检索类型：下拉选择（keywords/vector）
    - 引擎类型：下拉选择（postgres）
- 存储配额：数字输入框（可选，默认10737418240字节=10GB）
```

#### 2.1.3 租户详情
**功能描述**：查看租户的完整信息和相关数据统计。

**功能点**：
- 展示租户完整信息（基本信息、配置信息、资源使用情况）
- 展示租户关联资源统计：
  - 知识库数量
  - 知识文件数量
  - 会话数量
  - 模型数量
- 展示租户操作日志（可选，如果API支持）
- 提供编辑和删除操作入口
- API Key 完整显示，支持重新生成（警告：重新生成会使旧Key失效）
- 存储使用情况可视化展示（进度条、饼图）

**数据展示区域**：
1. **基本信息区域**
   - 租户ID、名称、描述
   - 业务标识
   - 状态（支持快速切换）
   - API Key（完整显示，支持复制和重新生成）

2. **配置信息区域**
   - 检索引擎配置详情
   - 存储配额配置

3. **资源使用区域**
   - 存储使用情况（已用/总额，使用率，可视化图表）
   - 关联资源统计（知识库数、知识数、会话数、模型数）

4. **时间信息区域**
   - 创建时间
   - 更新时间
   - 删除时间（如果已删除）

#### 2.1.4 编辑租户
**功能描述**：修改租户信息。

**功能点**：
- 可编辑字段：名称、描述、业务标识、检索引擎配置、存储配额、状态
- 注意：更新租户信息会导致 API Key 重新生成
- 提供明显的警告提示：修改配置将导致 API Key 变更
- 支持启用/禁用租户状态
- 表单验证同创建租户

**交互要求**：
- 编辑前显示确认提示："修改租户信息将导致 API Key 重新生成，请确保已通知租户。"
- 状态切换需要二次确认
- 存储配额只能增加，不能减少（或需特殊权限）

#### 2.1.5 删除租户
**功能描述**：删除租户及其关联数据。

**功能点**：
- 支持单个删除和批量删除
- 删除前需确认（显示警告信息）
- 删除前检查租户是否有关联资源（知识库、会话等）
- 提供软删除选项（推荐，保留数据记录）
- 删除操作不可逆，需二次确认
- 删除后从列表中移除或标记为已删除状态

**删除确认信息**：
- 租户名称
- 关联资源统计（知识库数、知识数等）
- 警告：删除操作不可恢复
- 选项：是否同时删除关联资源（谨慎操作）

### 2.2 租户监控模块

#### 2.2.1 资源使用监控
**功能描述**：实时监控租户的资源使用情况。

**功能点**：
- 存储使用监控
  - 当前使用量
  - 使用率百分比
  - 剩余配额
  - 使用趋势图表（近7天/近30天）
- 配额告警
  - 当使用率达到80%时显示警告
  - 当使用率达到95%时显示严重警告
  - 支持设置告警阈值
- 资源使用排行榜
  - 按存储使用量排序
  - 显示Top 10租户

**数据可视化**：
- 存储使用率环形图
- 存储使用趋势折线图
- 租户资源使用对比柱状图

#### 2.2.2 租户活动监控
**功能描述**：监控租户的活动情况（如果API支持）。

**功能点**：
- API 调用统计
  - 日/周/月调用量
  - 调用趋势图
- 知识库操作统计
  - 知识库创建/更新/删除次数
  - 知识文件上传次数
- 会话统计
  - 会话创建数量
  - 消息发送数量

**展示方式**：
- 数据表格
- 时间序列图表
- 统计卡片

### 2.3 统计分析模块

#### 2.3.1 租户统计概览
**功能描述**：展示系统整体租户统计数据。

**功能点**：
- 总租户数量
- 活跃租户数量
- 新增租户数量（今日/本周/本月）
- 总存储使用量
- 平均存储使用率
- 数据趋势图表

**展示组件**：
- 统计卡片（总数、新增、活跃数）
- 趋势折线图
- 分布饼图

#### 2.3.2 租户数据分析
**功能描述**：提供详细的租户数据分析功能。

**功能点**：
- 租户增长分析
  - 按时间段统计新增租户数
  - 增长率计算
- 资源使用分析
  - 存储使用分布
  - 高使用率租户识别
- 业务标识分析
  - 按业务标识分组统计
  - 各业务标识的租户数量和资源使用情况
- 导出数据报表
  - 支持导出Excel/CSV格式
  - 支持自定义导出字段

**分析维度**：
- 时间维度：日、周、月、年
- 业务维度：按业务标识分组
- 资源维度：存储使用情况

### 2.4 系统配置模块

#### 2.4.1 检索引擎配置管理
**功能描述**：管理租户的检索引擎配置。

**功能点**：
- 查看租户检索引擎配置
- 支持修改检索引擎配置
- 配置说明和帮助文档链接

**配置选项**：
- 检索类型：keywords（关键词检索）、vector（向量检索）
- 引擎类型：postgres
- 至少选择一种检索引擎类型

#### 2.4.2 存储配额管理
**功能描述**：管理租户的存储配额。

**功能点**：
- 查看租户当前存储配额和使用情况
- 支持调整存储配额（增加配额）
- 配额调整历史记录
- 配额告警设置

**交互要求**：
- 配额调整需要说明原因（可选）
- 配额减少需要特殊权限或审批流程
- 配额调整后记录操作日志

### 2.5 操作日志模块

#### 2.5.1 操作日志查看
**功能描述**：记录和查看租户相关的操作日志（如果API支持或需要实现）。

**功能点**：
- 记录租户创建、编辑、删除操作
- 记录配置变更操作
- 记录配额调整操作
- 支持按租户、操作类型、操作时间筛选
- 支持日志导出

**日志字段**：
- 操作时间
- 操作人员
- 租户ID/名称
- 操作类型
- 操作内容
- 操作结果

## 3. 非功能需求

### 3.1 性能需求
- 租户列表加载时间：< 2秒（1000条数据）
- 租户详情页加载时间：< 1秒
- 搜索响应时间：< 1秒
- 支持并发用户数：≥ 50

### 3.2 安全需求
- 需要管理员身份认证（登录验证）
- API Key 敏感信息需加密存储和传输
- 操作需记录审计日志
- 支持操作权限控制（如配额调整需高级权限）
- 敏感操作需二次确认

### 3.3 可用性需求
- 系统可用性：≥ 99.5%
- 支持7×24小时运行
- 错误提示信息清晰明确
- 操作流程符合用户习惯

### 3.4 兼容性需求
- 支持主流浏览器：Chrome、Firefox、Safari、Edge（最新两个版本）
- 支持响应式设计（适配桌面端和平板）
- 支持中文界面

### 3.5 可维护性需求
- 代码结构清晰，便于扩展
- 提供完善的日志记录
- 支持配置化管理

## 4. 用户角色与权限

### 4.1 系统管理员
**权限范围**：
- 租户的完整管理权限（增删改查）
- 配置修改权限
- 数据查看和导出权限
- 操作日志查看权限

### 4.2 运营人员
**权限范围**：
- 租户信息查看权限
- 数据统计和分析权限
- 数据导出权限
- 无修改权限

## 5. 界面设计要求

### 5.1 整体风格
- 采用现代化的后台管理界面风格
- 色彩搭配专业、简洁
- 符合主流后台管理系统设计规范
- 支持暗色主题（可选）

### 5.2 布局要求
- 左侧导航菜单 + 右侧内容区域
- 顶部导航栏（用户信息、退出登录等）
- 面包屑导航
- 响应式布局

### 5.3 组件要求
- 使用统一的UI组件库（如 Ant Design、Element UI 等）
- 表格支持排序、筛选、分页
- 表单验证提示友好
- 操作按钮有明确的视觉反馈
- 数据可视化使用图表库（如 ECharts、Chart.js 等）

### 5.4 交互要求
- 操作有加载状态提示
- 成功/失败有明确的提示信息
- 危险操作有二次确认
- 支持快捷键操作（如搜索、刷新等）

## 6. 技术实现建议

### 6.1 前端技术栈
- **框架**：React/Vue.js（推荐 React + TypeScript）
- **UI组件库**：Ant Design / Element Plus
- **状态管理**：Redux / Vuex / Zustand
- **数据可视化**：ECharts / Recharts
- **HTTP客户端**：Axios
- **路由**：React Router / Vue Router
- **构建工具**：Vite / Webpack

### 6.2 后端集成
- 基于现有的 WeKnora API（`/api/v1/tenants` 等接口）
- 需要实现管理员认证接口（如果API中未提供）
- 可能需要实现操作日志接口（如果API中未提供）
- 可能需要实现统计数据聚合接口（如果API中未提供）

### 6.3 数据存储
- 租户数据：通过 WeKnora API 获取（基于现有租户API）
- 操作日志：如API未提供，需要单独实现存储
- 统计数据：可通过API聚合计算或后端缓存

### 6.4 安全实现
- 使用 JWT Token 或 Session 进行身份认证
- API Key 在传输时使用 HTTPS
- 前端敏感信息脱敏显示
- 实现 CSRF 防护
- 实现 XSS 防护

## 7. API接口对接说明

### 7.1 租户管理接口
基于现有的租户管理API（参考 `docs/api/tenant.md`）：

- `GET /api/v1/tenants` - 获取租户列表
- `GET /api/v1/tenants/:id` - 获取租户详情
- `POST /api/v1/tenants` - 创建租户
- `PUT /api/v1/tenants/:id` - 更新租户
- `DELETE /api/v1/tenants/:id` - 删除租户

### 7.2 扩展需求接口
以下接口可能需要后端扩展实现：

1. **统计数据接口**
   - 获取租户统计数据（知识库数、知识数、会话数等）
   - 获取系统整体统计数据

2. **操作日志接口**（如需要）
   - 获取操作日志列表
   - 创建操作日志

3. **管理员认证接口**（如需要）
   - 管理员登录
   - 管理员信息获取
   - 权限验证

### 7.3 数据关联说明
租户与其他资源的关系：
- 租户 → 知识库（通过 tenant_id 关联）
- 租户 → 模型（通过 tenant_id 关联）
- 租户 → 会话（通过 tenant_id 关联）

可通过现有的API查询这些关联数据：
- 知识库列表API（需要统计每个租户的知识库数量）
- 模型列表API（需要统计每个租户的模型数量）
- 会话列表API（需要统计每个租户的会话数量）

## 8. 开发计划建议

### 8.1 第一阶段：基础功能（MVP）
- 租户列表展示
- 租户详情查看
- 创建租户
- 编辑租户基本信息
- 删除租户

**预计工期**：2-3周

### 8.2 第二阶段：监控与统计
- 资源使用监控
- 统计分析功能
- 数据可视化
- 数据导出

**预计工期**：2-3周

### 8.3 第三阶段：高级功能
- 操作日志
- 权限管理
- 配额管理优化
- 告警功能

**预计工期**：1-2周

## 9. 测试要求

### 9.1 功能测试
- 所有功能点的功能测试
- 表单验证测试
- 边界条件测试
- 异常情况处理测试

### 9.2 性能测试
- 大数据量下的列表加载性能
- 并发操作测试
- 接口响应时间测试

### 9.3 兼容性测试
- 主流浏览器兼容性测试
- 不同分辨率适配测试

### 9.4 安全测试
- 身份认证测试
- 权限控制测试
- XSS/CSRF 防护测试

## 10. 交付物

### 10.1 代码交付
- 前端代码（包含README和部署说明）
- 代码注释完善
- 代码符合规范

### 10.2 文档交付
- 用户操作手册
- 管理员使用指南
- API接口对接文档（如有扩展）
- 部署文档

### 10.3 测试交付
- 测试用例
- 测试报告
- Bug修复记录

## 11. 后续优化建议

### 11.1 功能扩展
- 租户分组管理
- 租户标签管理
- 租户使用情况报表（PDF导出）
- 自动化配额调整规则
- 租户健康度评估

### 11.2 性能优化
- 数据缓存机制
- 列表虚拟滚动（大数据量场景）
- 接口请求优化（批量查询）

### 11.3 用户体验优化
- 操作引导（首次使用）
- 快捷键支持
- 个性化配置（主题、布局等）
- 移动端适配（如需要）

## 附录：参考API文档

本文档基于以下API文档设计：
- `docs/api/tenant.md` - 租户管理API
- `docs/api/knowledge-base.md` - 知识库管理API
- `docs/api/model.md` - 模型管理API
- `docs/api/session.md` - 会话管理API
- `docs/api/README.md` - API总览

更多API详情请参考 `docs/api/` 目录下的相关文档。

